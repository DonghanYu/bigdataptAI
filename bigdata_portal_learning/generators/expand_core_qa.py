#!/usr/bin/env python3
"""
HIRA Core Q&A 템플릿 기반 확장
247개 → 600개로 확장
"""

import yaml
from pathlib import Path

# 추가할 템플릿 기반 Q&A
ADDITIONAL_QA = {
    "service_intro": [
        # 더 많은 데이터 관련 질문
        ("데이터는 매년 업데이트되나요?", "환자표본은 연 1회 갱신되고, 통계정보는 분기별 또는 월별로 업데이트됩니다."),
        ("어떤 통계를 볼 수 있나요?", "총진료비, 질병별 통계, 연령/성별/지역별 통계, 요양기관 통계 등 다양한 의료통계를 조회할 수 있습니다."),
        ("코호트 연구가 가능한가요?", "네, 맞춤형 데이터를 신청하면 환자 고유번호로 동일 환자의 여러 진료 이력을 추적하여 코호트 연구가 가능합니다."),
        ("데이터 샘플을 먼저 볼 수 있나요?", "환자표본 데이터를 무료로 다운로드하여 데이터 구조와 내용을 미리 확인할 수 있습니다."),
        ("처방전 데이터도 있나요?", "네, 원외처방내역 테이블에 병원 처방전을 약국에서 조제한 내역이 모두 포함되어 있습니다."),
        ("의료기관 정보는 어떻게 조회하나요?", "요양기관정보 테이블 또는 Open API를 통해 병원, 의원, 약국 정보를 조회할 수 있습니다."),
        ("수술 정보도 포함되나요?", "네, 원내진료내역에 수술 관련 행위코드가 포함되어 있어 수술 데이터 분석이 가능합니다."),
        ("약물 부작용 연구가 가능한가요?", "약품코드와 진단 정보를 연계하여 약물 안전성 연구가 가능합니다. 다만 직접적인 부작용 기록은 없습니다."),
        ("희귀질환 데이터는?", "산정특례 코드로 희귀난치성질환자를 식별할 수 있으며, 별도 환자표본도 제공됩니다."),
        ("암 환자 데이터는 어떻게 얻나요?", "C코드 상병코드 또는 산정특례 암 코드로 암 환자를 식별하여 분석할 수 있습니다."),
        ("고혈압 당뇨 데이터는?", "I10-I15(고혈압), E10-E14(당뇨) 상병코드로 만성질환자를 식별하여 연구할 수 있습니다."),
        ("소아 데이터만 추출 가능한가요?", "네, 연령 조건으로 0-19세를 선택하여 소아청소년 데이터만 추출할 수 있습니다."),
        ("노인 데이터 분석은?", "65세 이상 연령 조건으로 필터링하면 노인 의료이용 데이터를 분석할 수 있습니다."),
        ("응급실 이용 데이터는?", "응급의학과 진료과목 또는 응급 관련 행위코드로 응급실 이용 데이터를 식별할 수 있습니다."),
        ("재원일수는 어떻게 계산하나요?", "입원일자와 퇴원일자의 차이로 재원일수를 계산하며, 당일 퇴원은 1일로 계산됩니다."),
    ],

    "healthcare_bigdata": [
        # 자료신청 관련 추가 질문
        ("데이터 신청은 무료인가요?", "환자표본은 무료이고, 맞춤형 데이터는 규모에 따라 비용이 발생할 수 있으나 학술 연구는 감면됩니다."),
        ("신청 후 얼마나 기다려야 하나요?", "일반적으로 2-4주 소요되며, 서류 보완 요청이 있으면 더 걸릴 수 있습니다."),
        ("IRB 없이도 신청할 수 있나요?", "교육 목적이나 통계 작성은 IRB 면제 가능하지만, 연구 목적은 IRB 승인이 필수입니다."),
        ("학부생도 신청 가능한가요?", "네, 지도교수 명의로 신청하고 재학증명서를 제출하면 가능합니다."),
        ("여러 연도 데이터를 한번에 신청할 수 있나요?", "네, 필요한 연도를 모두 선택하여 한번에 신청할 수 있습니다."),
        ("변수를 추가로 신청할 수 있나요?", "승인 후 과제 변경 신청을 통해 변수를 추가할 수 있습니다."),
        ("분석 기간을 연장할 수 있나요?", "네, MY분석과제에서 연장 신청을 하면 심사 후 1회 연장이 가능합니다."),
        ("데이터를 USB로 가져갈 수 있나요?", "원시 데이터 반출은 불가하고, 분석 결과만 반출 심사를 거쳐 USB로 가져갈 수 있습니다."),
        ("SAS 말고 다른 프로그램도 사용 가능한가요?", "기본은 SAS이며, R이나 Python은 별도 승인이 필요합니다."),
        ("현장분석과 원격분석을 병행할 수 있나요?", "네, 한 과제에서 현장과 원격을 번갈아 사용할 수 있습니다."),
        ("분석 중 데이터가 삭제되나요?", "승인 기간 내에는 보관되며, 기간 만료 시 자동 삭제됩니다."),
        ("동료와 같이 분석할 수 있나요?", "공동연구자로 등록하면 함께 접속하여 분석할 수 있습니다. 단, 동시 접속은 1명만 가능합니다."),
        ("분석 중간에 과제를 중단할 수 있나요?", "네, MY분석과제에서 중단 신청을 하면 즉시 데이터가 삭제됩니다."),
        ("논문 투고 전에 데이터를 다시 받을 수 있나요?", "기간 내라면 재접속 가능하고, 기간 만료 시 재신청이 필요합니다."),
        ("3인 미만 셀은 왜 반출이 안 되나요?", "통계법에 따라 개인 식별 위험이 높아 3인 미만 셀은 반출이 금지됩니다."),
    ],

    "medical_statistics": [
        # 통계 조회 관련 추가 질문
        ("통계는 실시간으로 업데이트되나요?", "분기별 또는 월별로 업데이트되며, 최신 통계는 공지사항에 안내됩니다."),
        ("과거 10년 추이를 볼 수 있나요?", "네, 연도 범위를 선택하면 과거 통계와 비교하여 추이를 분석할 수 있습니다."),
        ("지역별로 진료비를 비교할 수 있나요?", "네, 시도별로 선택하여 지역 간 진료비와 진료건수를 비교할 수 있습니다."),
        ("연령대별 통계는 어떻게 보나요?", "통계 조회 시 연령 조건을 10세 단위로 선택하여 연령대별로 비교할 수 있습니다."),
        ("성별 차이를 볼 수 있나요?", "네, 성별을 선택하여 남녀 간 질병 패턴, 진료비 차이를 확인할 수 있습니다."),
        ("계절별 질병 통계는?", "월별 통계를 조회하여 계절에 따른 질병 발생 패턴을 분석할 수 있습니다."),
        ("다빈도 질병 순위는 어디서 보나요?", "질병 세분류 통계를 진료인원순으로 정렬하면 다빈도 질병 TOP을 확인할 수 있습니다."),
        ("병원 종별 통계는?", "요양기관 통계에서 상급종합, 종합병원, 병원, 의원별 통계를 비교할 수 있습니다."),
        ("치과 진료 통계도 있나요?", "네, 진료과목을 치과로 선택하면 치과 진료 통계를 조회할 수 있습니다."),
        ("한방 진료 통계는?", "진료과목을 한의과로 선택하면 침, 뜸, 한약 등 한방 진료 통계를 볼 수 있습니다."),
        ("약국 조제 통계는?", "처방전 통계에서 약국 조제 건수, 조제 금액, 다빈도 약품을 확인할 수 있습니다."),
        ("항생제 사용 통계는?", "의약품 통계에서 항생제로 필터링하거나, 평가결과 통계에서 항생제 적정성 평가를 확인할 수 있습니다."),
        ("중환자 통계는?", "진료 행위코드 중 중환자실 관련 코드를 조회하여 중환자 이용 통계를 분석할 수 있습니다."),
        ("수술 통계는 어떻게 보나요?", "수술 관련 행위코드로 필터링하여 수술 건수, 수술비용 통계를 확인할 수 있습니다."),
        ("암 통계는 별도로 있나요?", "산정특례 통계 또는 C코드 상병코드로 조회하면 암 종류별 통계를 확인할 수 있습니다."),
    ],

    "public_data": [
        # Open API 관련 추가 질문
        ("API 사용에 비용이 드나요?", "기본 API는 무료이며, 일일 트래픽 한도가 있습니다. 대량 사용은 별도 협의가 필요합니다."),
        ("API로 어떤 정보를 조회할 수 있나요?", "병원 정보, 의약품 정보, 행위코드, 상병코드, 일부 통계 등을 조회할 수 있습니다."),
        ("API 응답 형식은?", "XML 또는 JSON 형식으로 제공되며, 요청 시 type 파라미터로 선택할 수 있습니다."),
        ("API 사용량 제한은?", "개발계정은 일일 1,000건, 운영계정은 더 많은 트래픽이 제공됩니다."),
        ("API 오류가 발생하면 어떻게 하나요?", "응답 코드와 에러 메시지를 확인하고, API 문서를 참고하여 파라미터를 수정하세요."),
        ("API 버전 업데이트는 어떻게 알 수 있나요?", "공공데이터포털 API 상세 페이지에서 변경 이력을 확인하거나 이메일 알림을 받을 수 있습니다."),
        ("상용 서비스에 API를 사용할 수 있나요?", "네, 운영계정으로 전환하고 약관을 준수하면 상용 서비스에 사용 가능합니다."),
        ("API 샘플 코드가 있나요?", "공공데이터포털에서 Java, Python, JavaScript 등 언어별 샘플 코드를 제공합니다."),
        ("인증키 발급은 얼마나 걸리나요?", "대부분 즉시 발급되며, 일부는 1-3일의 심의 기간이 필요합니다."),
        ("통계간행물은 무료인가요?", "네, 모든 통계간행물은 PDF로 무료 다운로드 가능합니다."),
        ("과거 간행물도 볼 수 있나요?", "네, 통계간행물 메뉴에서 연도별로 과거 간행물을 모두 확인할 수 있습니다."),
        ("영문 간행물도 있나요?", "주요 통계 보고서는 영문 요약본이 제공되며, 일부는 영문 전체본도 있습니다."),
        ("데이터셋은 어떤 형식으로 제공되나요?", "CSV 또는 Excel 형식으로 제공되며, 파일 크기에 따라 압축되어 제공될 수 있습니다."),
        ("데이터셋은 얼마나 자주 업데이트되나요?", "데이터셋 종류에 따라 월별, 분기별, 연별로 업데이트 주기가 다릅니다."),
        ("API와 데이터셋 중 뭘 사용해야 하나요?", "실시간 조회가 필요하면 API, 대량 데이터 분석이 필요하면 데이터셋 다운로드를 권장합니다."),
    ],

    "customer_support": [
        # 고객지원 관련 추가 질문
        ("전화 상담 가능한 시간은?", "평일 09:00-18:00이며, 점심시간(12:00-13:00)에도 가능합니다."),
        ("주말에도 문의할 수 있나요?", "게시판 문의는 24시간 가능하나, 답변은 평일에 제공됩니다."),
        ("긴급 문의는 어떻게 하나요?", "고객센터(033-739-1018)로 전화 문의하시면 빠른 도움을 받을 수 있습니다."),
        ("교육 프로그램은 언제 진행되나요?", "정기적으로 진행되며, 공지사항에서 일정을 확인할 수 있습니다."),
        ("온라인 교육도 있나요?", "네, 온라인 교육과 오프라인 교육이 모두 제공됩니다."),
        ("교육 참가비가 있나요?", "대부분 무료이며, 일부 전문 과정은 소정의 비용이 있을 수 있습니다."),
        ("교육 수료증을 받을 수 있나요?", "네, 교육 이수 시 수료증이 발급됩니다."),
        ("SAS 교육도 제공되나요?", "네, 초급, 중급, 고급 과정으로 SAS 기본 문법부터 고급 통계까지 교육합니다."),
        ("통계 분석 상담도 받을 수 있나요?", "네, 연구 설계, 변수 선택, 통계 방법에 대한 기술 상담을 제공합니다."),
        ("게시판에 올린 질문은 언제 답변되나요?", "보통 1-3일 내에 답변되며, 복잡한 문의는 더 걸릴 수 있습니다."),
        ("비밀글로 문의할 수 있나요?", "1:1 문의는 비공개로 처리되며, 본인만 확인할 수 있습니다."),
        ("시스템 오류는 어디에 신고하나요?", "1:1 문의나 고객센터로 오류 화면을 캡처하여 제출하시면 빠르게 처리됩니다."),
        ("회원 정보를 수정하려면?", "마이페이지에서 회원정보 수정 메뉴를 이용하시면 됩니다."),
        ("비밀번호를 잊어버렸는데 어떻게 하나요?", "로그인 화면에서 비밀번호 찾기를 클릭하면 이메일로 재설정 링크가 전송됩니다."),
        ("탈퇴하려면 어떻게 하나요?", "마이페이지에서 회원 탈퇴를 신청할 수 있으나, 진행 중인 과제가 있으면 제한됩니다."),
    ],
}

def expand_core_qa():
    """기존 core Q&A에 추가 Q&A 병합"""

    # 기존 파일 로드
    core_qa_path = Path("/home/user/bigdataptAI/bigdata_portal_learning/config/hira_core_qa.yaml")
    with open(core_qa_path, 'r', encoding='utf-8') as f:
        data = yaml.safe_load(f)

    original_count = sum(len(items) for items in data['core_qa'].values())
    print(f"기존 Core Q&A: {original_count}개")

    # 추가 Q&A 병합
    for menu, qa_list in ADDITIONAL_QA.items():
        if menu in data['core_qa']:
            for q, a in qa_list:
                data['core_qa'][menu].append({"q": q, "a": a})
        else:
            data['core_qa'][menu] = [{"q": q, "a": a} for q, a in qa_list]

    new_count = sum(len(items) for items in data['core_qa'].values())
    added_count = new_count - original_count

    print(f"추가된 Q&A: {added_count}개")
    print(f"최종 Core Q&A: {new_count}개")

    # 저장
    output_path = Path("/home/user/bigdataptAI/bigdata_portal_learning/config/hira_core_qa_expanded.yaml")
    with open(output_path, 'w', encoding='utf-8') as f:
        yaml.dump(data, f, allow_unicode=True, default_flow_style=False, sort_keys=False)

    print(f"\n✅ 저장 완료: {output_path}")
    return new_count

if __name__ == "__main__":
    expand_core_qa()
