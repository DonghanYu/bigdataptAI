#!/usr/bin/env python3
"""
HIRA 메뉴 구조 기반 확장된 Core Q&A 생성기
목표: 600개 이상의 체계적인 Q&A
"""

import yaml
from pathlib import Path
from typing import Dict, List

# 메뉴별 상세 Q&A 정의
MENU_QA_DATA = {
    "service_intro": {
        "service_overview": [
            ("HIRA 보건의료빅데이터개방시스템이 뭔가요?", "건강보험심사평가원(HIRA)이 보유한 전 국민 의료이용 빅데이터를 연구자, 정책입안자 등에게 개방하여 연구와 정책 수립에 활용할 수 있도록 지원하는 시스템입니다."),
            ("어떤 사람들이 이용할 수 있나요?", "연구자, 대학원생, 정책입안자, 의료기관 종사자 등 누구나 회원가입 후 이용 가능합니다. 다만 연구 목적 데이터는 IRB 승인과 소속 기관 증빙이 필요합니다."),
            ("무료로 이용할 수 있나요?", "환자표본 데이터, 통계 조회, Open API는 무료입니다. 맞춤형 연구분석 데이터는 추출 규모와 분석 기간에 따라 비용이 발생할 수 있으나, 학술 연구는 감면됩니다."),
            ("opendata.hira.or.kr 주소가 맞나요?", "네, opendata.hira.or.kr이 HIRA 보건의료빅데이터개방시스템의 공식 주소입니다."),
            ("HIRA 본 사이트와 차이점은?", "www.hira.or.kr은 심사평가 업무 중심이고, opendata.hira.or.kr은 빅데이터 개방과 연구 지원에 특화된 사이트입니다."),
            ("서비스는 24시간 이용 가능한가요?", "웹사이트는 24시간 접속 가능하나, 시스템 점검 시간(매월 마지막 주 일요일)에는 일부 서비스가 제한됩니다."),
            ("해외에서도 접속할 수 있나요?", "네, 해외에서도 접속 가능합니다. 다만 원격분석 서비스는 보안상 IP 제한이 있을 수 있으니 사전 문의가 필요합니다."),
            ("모바일 앱이 있나요?", "별도 모바일 앱은 없으며, PC 웹 환경에 최적화되어 있습니다. 모바일 브라우저로 일부 기능은 이용 가능합니다."),
            ("회원가입 없이도 볼 수 있는 정보가 있나요?", "공지사항, 서비스 소개, 일부 통계 조회는 비회원도 가능하나, 데이터 다운로드나 신청은 로그인이 필수입니다."),
            ("기업도 이용할 수 있나요?", "네, 기업 소속 연구원도 이용 가능합니다. 다만 상업적 이용은 제한되며, 연구 목적으로만 사용해야 합니다."),
            ("외국인도 신청할 수 있나요?", "한국 소속 기관이 있는 외국인은 신청 가능하며, IRB와 재직증명서가 필요합니다. 순수 해외 연구자는 국내 공동연구자가 필요합니다."),
            ("서비스 이용 약관은 어디서 확인하나요?", "메인 화면 하단의 '이용약관' 링크에서 확인할 수 있습니다. 회원가입 시 약관 동의가 필수입니다."),
            ("개인정보는 어떻게 보호되나요?", "모든 데이터는 법적 기준에 따라 비식별 처리되며, 망분리 환경에서만 분석 가능합니다. 원시 데이터 반출은 불가하고 집계 결과만 심사 후 제공됩니다."),
            ("데이터 보안 서약서는 왜 필요한가요?", "데이터를 연구 목적으로만 사용하고, 제3자 제공 금지, 개인 식별 시도 금지를 서약하기 위함입니다. 위반 시 법적 책임이 있습니다."),
            ("시스템 이용 중 문제가 생기면 어디에 문의하나요?", "고객지원 > 1:1 문의 게시판 또는 빅데이터정보부(033-739-1018)로 문의하세요. 평일 09:00-18:00 운영됩니다."),
        ],

        "data_intro": [
            ("HIRA 데이터 규모는 얼마나 되나요?", "약 3조 건, 200TB 규모입니다. 건강보험, 의료급여, 자동차보험의 전 국민 진료 내역이 포함되어 있습니다."),
            ("데이터는 언제부터 언제까지 있나요?", "환자표본은 2009-2018년 연도별 제공되고, 맞춤형 데이터는 연구 목적에 따라 최신 연도까지 신청 가능합니다."),
            ("5대 핵심 테이블이 뭔가요?", "명세서일반내역, 원내진료내역, 전체상병내역, 원외처방내역, 요양기관정보입니다. 이 5개 테이블로 대부분의 분석이 가능합니다."),
            ("명세서일반내역에는 어떤 정보가 있나요?", "환자 기본 정보(연령, 성별, 지역), 요양기관 정보(종별, 지역), 진료일자, 총진료비, 본인부담금, 진료과목 등 청구 명세서의 기본 정보입니다."),
            ("원내진료내역은 뭔가요?", "병원에서 시행한 진료행위, 약제, 치료재료 내역입니다. 행위코드, 약품코드, 1회 투약량, 투여일수, 금액 등이 포함됩니다."),
            ("전체상병내역은 무엇인가요?", "환자의 진단 정보(주상병, 부상병)를 담은 테이블입니다. KCD 상병코드와 상병명이 기록되어 질병별 분석에 활용됩니다."),
            ("원외처방내역은 뭔가요?", "병원에서 처방전을 발급받아 약국에서 조제한 내역입니다. 약품코드, 투약량, 투여일수, 조제금액 등이 포함됩니다."),
            ("요양기관정보 테이블은?", "병원, 의원, 약국 등 의료기관의 기본 정보입니다. 요양기관 기호, 명칭, 종별, 소재지, 설립구분, 진료과목, 병상수 등이 포함됩니다."),
            ("데이터 테이블 간 관계는 어떻게 되나요?", "명세서일반내역(KEY)을 중심으로 원내진료내역, 전체상병내역, 원외처방내역이 연결됩니다. 요양기관정보는 요양기관기호로 조인 가능합니다."),
            ("비식별 처리는 어떻게 되어 있나요?", "이름, 주민번호, 상세 주소 등 개인 식별 정보는 제거되고, 연령은 5세 단위로 범주화, 지역은 시도 단위로 제공됩니다."),
            ("환자 고유번호로 추적이 가능한가요?", "네, 환자 고유번호(암호화된 ID)로 동일 환자의 여러 진료 이력을 추적하여 코호트를 구축할 수 있습니다."),
            ("입원과 외래 데이터가 구분되나요?", "네, 명세서일반내역의 명세서 구분 필드로 입원(I), 외래(O)를 구분할 수 있습니다."),
            ("급여와 비급여 데이터는?", "데이터에는 주로 급여 진료(건강보험 적용)가 포함되며, 비급여(미용, 성형 등)는 일부만 포함되거나 제외됩니다."),
            ("연령 변수는 어떻게 제공되나요?", "개인 식별 방지를 위해 5세 단위로 범주화됩니다. 예: 0-4세, 5-9세, 10-14세 등."),
            ("성별 변수는 있나요?", "네, 남(M), 여(F)로 구분되어 명세서일반내역에 포함되어 있습니다."),
        ],
    },

    # ... 나머지 메뉴들도 동일하게 추가...
}

def generate_core_qa_yaml():
    """확장된 core Q&A YAML 생성"""

    output = {
        "core_qa": {}
    }

    total_count = 0

    for menu, submenu_data in MENU_QA_DATA.items():
        output["core_qa"][menu] = []

        for submenu, qa_list in submenu_data.items():
            for q, a in qa_list:
                output["core_qa"][menu].append({"q": q, "a": a})
                total_count += 1

    print(f"✅ 총 {total_count}개 Q&A 생성 완료")

    # YAML 저장
    output_path = Path("/home/user/bigdataptAI/bigdata_portal_learning/config/hira_core_qa_expanded.yaml")
    with open(output_path, 'w', encoding='utf-8') as f:
        yaml.dump(output, f, allow_unicode=True, default_flow_style=False, sort_keys=False)

    print(f"📁 저장 완료: {output_path}")

    return total_count

if __name__ == "__main__":
    count = generate_core_qa_yaml()
